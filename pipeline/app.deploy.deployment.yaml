
parameters:
  jobName: 'deploy'
  dependsOn: 'apps'
  environment: ''

jobs:
- deployment: ${{ parameters.jobName }}
  displayName: Deploy App
  environment: ${{ parameters.environment }}
  dependsOn: 
    - ${{ parameters.dependsOn }}
  pool:
    vmImage: 'ubuntu-latest'

  variables:
  - group: AzureDeploySP
  - name: acrName
    value: $[ dependencies.infrastructure.outputs['pulumi.acrName'] ]
  - name: webAppResourceId
    value: $[ dependencies.infrastructure.outputs['pulumi.webAppResourceId'] ]

  strategy:
    runOnce:
      deploy:
        steps:
        - template: deploy/app.deploy.steps.yaml