@page
@model Amphora.Api.Pages.IndexModel
@{
    ViewData["Title"] = "Home Page";
}

<div class="container">

    <div class="row justify-content-center">
        <div class="col text-center">
            <h1>Welcome to Amphora Data</h1>
            <p>A platform to discover, package, and trade data to increase sustainability and profitability of farms</p>
            <hr/>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-10">
            <div id="homeCarousel" class="carousel slide" data-ride="carousel" data-interval="10000">
                <div class="carousel-inner">
                    <div class="carousel-item active text-center">
                        <canvas id="wordcloud" width="1200px" height="800px"></canvas>
                    </div>
                    <div class="carousel-item">
                        @await Component.InvokeAsync("FeaturedAmphora")
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="~/images/stock/shutterstock_1504965485.jpg" alt="A picture of a farmer and a cow">
                        <div class="carousel-caption">
                            <p>Amphora Data helps you coordinate with your collegues.</p>
                            <a asp-area="Organisations" asp-page="/Detail" class="btn btn-primary btn-block">My Organisation</a>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="~/images/stock/market.jpg" alt="Picture of a Marketplace with spices">
                        
                        <div class="carousel-caption">
                            <p >The marketplace is the core of the Amphora ecosystem.</p>
                            <a asp-page="market/index" class="btn btn-primary btn-block">Marketplace</a>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="~/images/stock/shutterstock_773657248.jpg" alt="Picture of people collaborating">
                        <div class="carousel-caption">
                            <p class="card-text">We're building a community of trust. Build your profile here.</p>
                            <a asp-area="Profiles" asp-page="Account/Detail" class="btn btn-primary btn-block">My Profile</a>
                        </div>
                    </div>
                </div>
                <a class="carousel-control-prev" href="#homeCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#homeCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/wordcloud/src/wordcloud2.js"></script>
    <script>
        var list = @Html.Raw(@Newtonsoft.Json.JsonConvert.SerializeObject(Model.Frequencies));
        var maxWordCount = @Html.Raw(Model.MaxWordCount);
        var minWordCount = @Html.Raw(Model.MinWordCount);
        var weightFactor = function (size) {
            var normalisedSize = 1 + (size / maxWordCount);
            var n = normalisedSize * Math.log(normalisedSize) * $('#wordcloud').width() ;
            return n;
        }

        var clickCallback = function callback(item, dimension, event) {
            var base_url = window.location.origin;
            if(item && item[0])
            {
                window.location = `${base_url}/Discover?SearchDefinition.Term=${item[0]}`;
            }
        }
        window.addEventListener('load', function() {
            var options = { list: list, 
                weightFactor, 
                shrinkToFit: true, 
                shape: "square", 
                clearCanvas: true, 
                fontFamily: 'Fjalla One, sans-serif',
                click: clickCallback}
            WordCloud(document.getElementById('wordcloud'), options  );
        });
    </script>

}