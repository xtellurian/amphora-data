@page
@model Restrictions.CreatePageModel

@{
    ViewData["Title"] = "Create Restriction";
}

<div class="container">
    <div class="row">
        <div class="col-sm-8">
            <h2>Restrict an Organisation</h2>
            <h4>from accessing this Amphora </h4>
            <small>
                <a asp-page="/Detail" asp-area="Amphorae" asp-route-id="@Model.Amphora.Id">
                    @Model.Amphora.Name 
                </a>
            </small>
        </div>
        <div class="col-sm-4 text-right">
            <a class="btn btn-secondary" asp-page="./Index" asp-route-id="@Model.Amphora.Id">
                Currently Restricted Organisation
            </a>
        </div>
    </div>
    <hr/>
    <div class="row">
        <div class="col-8">
            <div id="orgDetail" class="container">
                <div class="row">
                    <div class="col-8">
                        <span id="orgName"></span>
                    </div>
                    <div class="col-4 text-right">
                        <a id="linker" class="btn btn-primary mb-2" asp-area="Organisations" asp-page="/Detail">
                            View
                        </a>
                    </div>
                </div>
            </div>
            <form method="post" asp-route-id="@Model.Amphora.Id">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                 <div class="form-group">
                    <input id="orgNameInput" class="form-control" placeholder="Find an Organisation"/>
                </div>
                <div class="form-group">
                    <input id="targetOrgId" hidden asp-for="NewRestriction.TargetOrganisationId" class="form-control" placeholder="Id of the Organisation to restrict."/>
                    <span asp-validation-for="NewRestriction.TargetOrganisationId" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <input type="submit" value="Restrict Organisation" class="btn btn-primary btn-block" />
                </div>
            </form>
        </div>
        <div class="col-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-info-circle"></i> What is a restriction?
                    </h5>
                    <h6 class="card-subtitle mb-2 text-muted">Information</h6>
                    <p class="card-text">
                        Restricting an Organisation means they won't be able to purchase your Amphora or access any of the data it contains.
                        You can restrict an Organisation from accessing one or all of your Amphora.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_AutocompleteImportPartial" />
    <script src="~/js/organisationsAutocomplete.js"></script>
    <script>
        let onSelection =  (feedback) => {
            const orgId = feedback.selection.value.id;
            const name = feedback.selection.value.name;
            document.getElementById("targetOrgId").value = orgId
            document.getElementById("orgName").innerText = `Restrict ${name}?`
            document.getElementById("linker").href += `?id=${orgId}`
            document.getElementById("orgDetail").style.display = "block";
            console.log("selected")
        }
        document.getElementById("orgDetail").style.display = "none"; // start hidden
        organisationsAutocomplete("orgNameInput", "orgNameInput_results_list", "orgListDestination", "/api/search/organisations", onSelection )
    </script>
}