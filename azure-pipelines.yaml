trigger:
  branches:
    include:
    - master
    - develop
  tags:
    include:
    - demo/*

stages:
- stage: branch
  displayName: Branch Stage
  condition: and(succeeded(), startsWith(variables['Build.SourceBranch'], 'refs/heads/'))
  jobs:
  - template: pipeline/infra.create.job.yaml
  - template: pipeline/app.test.job.yaml
  - template: pipeline/app.deploy.job.yaml

- stage: deploy
  displayName: Deploy to Demo Envionment 
  condition: and(succeeded(), startsWith(variables['Build.SourceBranch'], 'refs/tags/demo/'))
  variables: 
    stack: demo
  jobs:
    - template: pipeline/infra.create.job.yaml
    - template: pipeline/app.test.job.yaml
    - template: pipeline/app.deploy.job.yaml