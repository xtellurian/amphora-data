
trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: Pulumi xtellurian

steps:
  - script: curl -fsSL https://get.pulumi.com | sh
    condition: eq(variables['Build.Reason'], 'Manual')
    displayName: Install Pulumi 

  - script: npm install
    condition: eq(variables['Build.Reason'], 'Manual')
    workingDirectory: pulumi
    displayName: NPM install

  - task: Pulumi@0
    condition: eq(variables['Build.Reason'], 'Manual')
    inputs:
      azureSubscription: "amphoradata1"
      command: "preview"
      cwd: "pulumi/"
      stack: "xtellurian/amphora/test"

  - task: Pulumi@0
    condition: eq(variables['Build.Reason'], 'Manual')
    inputs:
      azureSubscription: "amphoradata1"
      command: "$(action)"
      cwd: "pulumi/"
      stack: "xtellurian/amphora/test"